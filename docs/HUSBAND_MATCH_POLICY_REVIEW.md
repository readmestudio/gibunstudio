# 남편상 테스트 & 결제 퍼널 정책

> **작성일**: 2026-02-06
> **최종 수정**: 2026-02-06
> **상태**: ✅ 정책 확정

---

## 확정된 정책 요약

| 항목 | 정책 |
|------|------|
| **테스트 횟수** | 1인 1회 (재분석 불가) |
| **리포트 보관** | 1년 (무료/유료 동일) |
| **계정 삭제 시** | 모든 데이터 삭제 |
| **환불 정책** | 서베이 제출 전: 전액 환불 / 제출 후: 환불 불가 |
| **환불 신청** | 카카오톡 `gibun_studio` |
| **입금 확인 SLA** | 24시간 이내 |
| **리포트 공개 SLA** | 24시간 이내 |
| **완료 알림** | 알림톡 + 가입 이메일 |

---

## 1. 테스트 횟수 정책 ✅

### 확정 내용

```
- Phase1(무료): 계정당 1회만 제공
- Phase2(유료): Phase1당 1회만 제공
- 재분석: 허용하지 않음
```

### 세부 사항

| 항목 | 정책 | 비고 |
|------|------|------|
| Phase1 분석 | 1인 1회 | DB UNIQUE 제약으로 구현됨 |
| Phase2 분석 | Phase1당 1회 | DB UNIQUE 제약으로 구현됨 |
| 재분석 | 불허 | 새 계정 생성은 사용자 책임 |

### 구현 상태

- [x] Phase1 1회 제한 (`UNIQUE(user_id)`)
- [x] Phase2 1회 제한 (`UNIQUE(phase1_id)`)
- [x] 기존 결과 있을 시 기존 ID 반환

---

## 2. 리포트 보관 정책 ✅

### 확정 내용

```
- 무료 리포트(Phase1): 생성일로부터 1년 보관
- 유료 리포트(Phase2): 생성일로부터 1년 보관
- 계정 삭제 시: 모든 데이터 즉시 삭제
```

### 세부 사항

| 항목 | 정책 | 구현 필요 |
|------|------|----------|
| Phase1 보관 기간 | 1년 | ⚠️ 자동 삭제 로직 필요 |
| Phase2 보관 기간 | 1년 | ⚠️ 자동 삭제 로직 필요 |
| YouTube 데이터 | 1년 (리포트와 동일) | ⚠️ 자동 삭제 로직 필요 |
| 계정 삭제 시 | 즉시 삭제 | ⚠️ CASCADE 삭제 구현 필요 |
| 만료 알림 | 미정 | 추후 결정 |

### 구현 TODO

- [ ] 리포트 만료 자동 삭제 크론잡/스케줄러
- [ ] 계정 삭제 시 관련 데이터 CASCADE 삭제
- [ ] 이용약관에 보관 기간 명시

---

## 3. 환불 정책 ✅

### 확정 내용

```
- 서베이 제출 전: 전액(100%) 환불
- 서베이 제출 후: 환불 불가
- 결제 화면에 환불 정책 명시 필수
- 환불 신청: 카카오톡 gibun_studio
```

### 세부 사항

| 시점 | 환불 | 비고 |
|------|------|------|
| 결제 완료 ~ 서베이 제출 전 | ✅ 전액 환불 | 고객 요청 시 |
| 서베이 제출 후 | ❌ 환불 불가 | 디지털 콘텐츠 예외 적용 |

### 환불 신청 방법

```
카카오톡 채널: gibun_studio
- 환불 요청 메시지 발송
- 입금자명, 결제일, 환불 사유 기재
- 영업일 기준 3일 이내 처리
```

### 구현 TODO

- [ ] 결제 페이지에 환불 정책 고지 문구 추가
- [ ] 환불 동의 체크박스 추가
- [ ] 코치 패널에 환불 처리 기능 추가
- [ ] 환불 시 데이터 삭제 로직

### 결제 페이지 표기 문구 (예시)

```
※ 환불 정책
- 심층 분석 설문 제출 전: 전액 환불 가능
- 심층 분석 설문 제출 후: 환불 불가
- 환불 신청: 카카오톡 gibun_studio
```

---

## 4. SLA (서비스 수준 협약) ✅

### 확정 내용

```
- 무통장 입금 확인: 24시간 이내
- 리포트 검토/공개: 24시간 이내
- 완료 알림: 알림톡 + 가입 이메일
```

### 세부 사항

| 단계 | SLA | 알림 방법 |
|------|-----|----------|
| 입금 확인 | 24시간 이내 | 알림톡 + 이메일 |
| 리포트 검토/공개 | 24시간 이내 | 알림톡 + 이메일 |

### 구현 TODO

- [ ] 카카오 알림톡 API 연동
- [ ] 입금 확인 완료 알림 발송
- [ ] 리포트 공개 완료 알림 발송
- [ ] 이메일 발송 (Supabase Auth 이메일 또는 별도 서비스)

### 알림 메시지 예시

**입금 확인 완료 알림톡:**
```
[GIBUN] 입금이 확인되었습니다.

안녕하세요, {이름}님!
심층 분석 결제가 확인되었습니다.

지금 바로 9개의 심층 질문에 답변해주세요.
👉 {서베이 링크}

문의: 카카오톡 gibun_studio
```

**리포트 공개 완료 알림톡:**
```
[GIBUN] 심층 분석 리포트가 도착했습니다!

안녕하세요, {이름}님!
심층 분석 리포트가 완성되었습니다.

지금 바로 확인해보세요.
👉 {리포트 링크}

문의: 카카오톡 gibun_studio
```

---

## 서비스 플로우 (정책 반영)

```
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 1 (무료)                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 사용자 로그인                                              │
│  2. YouTube 구독 데이터 수집 또는 캡처 이미지 업로드          │
│  3. LLM 분석                                                   │
│  4. phase1_results에 저장 (카드 12장)                         │
│  5. 무료 리포트 즉시 조회 가능                                 │
│                                                                 │
│  📌 정책: 1인 1회, 재분석 불가                                 │
│  📌 보관: 1년                                                   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────────┐
│                    PHASE 2 (유료 ₩4,900)                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 결제 요청 (환불 정책 고지 및 동의)                        │
│     └─ ※ 서베이 제출 전 전액 환불 / 제출 후 환불 불가         │
│  2. 무통장 입금                                                 │
│  3. 입금 확인 (24시간 이내)                                    │
│     └─ 알림톡 + 이메일 발송                                    │
│  4. Phase2 서베이 작성 (9문항)                                 │
│     └─ ⚠️ 이 시점 이후 환불 불가                              │
│  5. LLM 심층 분석                                              │
│  6. 코치 검토 (24시간 이내)                                    │
│  7. 리포트 공개 → 알림톡 + 이메일 발송                        │
│  8. 사용자 리포트 열람 가능                                    │
│                                                                 │
│  📌 정책: Phase1당 1회                                         │
│  📌 보관: 1년                                                   │
│  📌 환불 신청: 카카오톡 gibun_studio                           │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 구현 체크리스트

### 필수 (런칭 전)

- [x] **테스트 횟수 제한** - 이미 구현됨
- [ ] **결제 페이지 환불 정책 고지**
  - [ ] 환불 정책 문구 추가
  - [ ] 동의 체크박스 추가
- [ ] **알림 시스템**
  - [ ] 카카오 알림톡 API 연동
  - [ ] 입금 확인 알림
  - [ ] 리포트 공개 알림
- [ ] **이용약관 업데이트**
  - [ ] 테스트 횟수 정책 명시
  - [ ] 리포트 보관 기간 명시
  - [ ] 환불 정책 명시

### 권장 (런칭 후)

- [ ] **데이터 만료 처리**
  - [ ] 1년 지난 리포트 자동 삭제 스케줄러
  - [ ] 만료 예정 알림 (선택)
- [ ] **계정 삭제 기능**
  - [ ] 관련 데이터 CASCADE 삭제
- [ ] **환불 처리 시스템**
  - [ ] 코치 패널 환불 버튼
  - [ ] 환불 시 데이터 처리

---

## 관련 파일

| 파일 | 수정 필요 사항 |
|------|---------------|
| `/src/app/husband-match/payment/[phase1_id]/page.tsx` | 환불 정책 고지 문구 추가 |
| `/docs/supabase-schema.sql` | 데이터 삭제 정책 반영 |
| `/src/app/api/coach/payment/confirm/route.ts` | 알림톡 발송 추가 |
| `/src/app/api/coach/phase2/publish/route.ts` | 알림톡 발송 추가 |
| 이용약관 페이지 (신규) | 정책 명시 |

---

## 부록: 법적 고려사항

### 전자상거래법 청약철회 예외

디지털 콘텐츠의 경우 아래 조건 충족 시 청약철회 제한 가능:
1. 사전에 "환불 불가" 고지
2. 고객의 명시적 동의
3. 콘텐츠 제공 시작 시점 명확

**적용:**
- 서베이 제출 = 콘텐츠 제공 시작
- 결제 시 환불 정책 고지 및 동의 필수
