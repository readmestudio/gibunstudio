# 남편상 분석 카드 프롬프트 & 생성 결과 레퍼런스

## 구조 개요

```
카드 생성 흐름:
  시스템 프롬프트 (공통)
  + 공유 분석 데이터 컨텍스트 (공통)
  + 배치별 카드 지시문 (3개 배치)
  = 11장 카드 생성
```

| 배치 | 카드 | 모델 | max_tokens |
|------|------|------|------------|
| - | 카드 1 | 없음 (고정 텍스트) | - |
| 배치 1 | 카드 2, 3, 4 | gemini-2.0-flash | 4096 |
| 배치 2 | 카드 5, 6, 7, 8 | gemini-2.0-flash | 4096 |
| 배치 3 | 카드 9, 10, 11 | gemini-2.0-flash | 4096 |

---

## 0. 시스템 프롬프트 (모든 배치 공통)

> 파일: `src/lib/husband-match/prompts/system-prompt.ts`

```
당신은 심리 분석과 관계 상담에 전문성을 갖춘 심리 분석 전문가입니다.

역할:
- YouTube 구독 채널 분석 결과를 바탕으로 사용자의 성격, 가치관, 관계 스타일을 해석합니다.
- TCI(기질·성격검사), MBTI, 애니어그램 등 심리학적 프레임워크를 활용해 공감적이고 따뜻한 언어로 설명합니다.
- 결혼·연애에 대한 인사이트를 제공하되, 판단하지 않고 이해와 격려를 전달합니다.

톤:
- 따뜻하고 공감적이며, 전문적이되 딱딱하지 않게 작성합니다.
- "당신", "당신의" 등 2인칭을 사용해 직접적으로 대화합니다.
- 부정적 표현을 피하고, 강점과 가능성에 초점을 맞춥니다.

출력 형식:
- 요청된 카드 내용만 2~3문단으로 작성합니다.
- 제목이나 번호는 포함하지 않고, 본문 내용만 반환합니다.
- 한국어로만 작성합니다.
- 마크다운 형식은 사용하지 않습니다. 일반 문단만 사용합니다.
```

---

## 1. 공유 분석 데이터 컨텍스트 (모든 배치에 포함)

> 파일: `src/app/api/analyze/phase1/run-from-channels.ts` → `buildAnalysisContext()`

아래 템플릿의 `${...}` 부분에 실제 분석 수치가 삽입됩니다.

```
## 분석 데이터
- 총 채널 수: ${data.channelCount}개
- YouTube 카테고리 분포:
${ytCats.map(c => `  · ${c.name}: ${c.count}개 (${c.percent}%)`).join('\n')}

- 희소성 분석:
  · 상위 ${rarity.percentile}% (코사인 유사도: ${rarity.cosineSimilarity})
  · 가장 희귀한 카테고리: ${rarity.rarestCategoryName} (${rarity.rarestCategoryPercent}%)
  · 해당 채널: ${rarity.rarestCategoryChannels.join(', ')}

- TCI 6축 (육각형 스탯):
  · ${topBottom.top1.name}: ${topBottom.top1.score}점 (1위)
  · ${topBottom.top2.name}: ${topBottom.top2.score}점 (2위)
  · ${topBottom.bottom.name}: ${topBottom.bottom.score}점 (최저)
  · 자기초월(ST): ${data.youtubeTCI.ST}, 자율성(SD): ${data.youtubeTCI.SD}
  · 자극추구(NS): ${data.youtubeTCI.NS}, 위험회피(HA): ${data.youtubeTCI.HA}
  · 인내력(P): ${data.youtubeTCI.P}, 연대감(CO): ${data.youtubeTCI.CO}

- TCI 상위: ${topTCI.map(x => `${x.name}(${x.score}점)`).join(', ')}
- 애니어그램: ${ennea}번 (${enneaName})
- MBTI: ${data.mbti_type}
- MBTI 특성: ${mbtiTraits.join(', ')}
- 매칭된 남편상: ${h.name} (${h.category} - ${h.subcategory})
- 매칭 점수: ${scorePercent}%
```

### 이번 테스트에서 삽입된 실제 값 (예시)

```
## 분석 데이터
- 총 채널 수: 23개
- YouTube 카테고리 분포:
  · 기타: 9개 (39%)
  · 브이로그/일상: 4개 (17%)
  · 예능/버라이어티: 3개 (13%)
  · 교육/자기계발: 2개 (9%)
  · 음악: 2개 (9%)
  · ASMR: 1개 (4%)
  · 뷰티/패션: 1개 (4%)
  · 먹방/요리: 1개 (4%)

- 희소성 분석:
  · 상위 10% (코사인 유사도: 0.64)
  · 가장 희귀한 카테고리: ASMR (4%)
  · 해당 채널: 낮잠 NZ Ambience

- TCI 6축 (육각형 스탯):
  · 자율성(SD): 100점 (1위)
  · 자극추구(NS): 100점 (2위)
  · 위험회피(HA): 30점 (최저)
  · 자기초월(ST): 10, 자율성(SD): 15
  · 자극추구(NS): 60, 위험회피(HA): 18
  · 인내력(P): 7, 연대감(CO): 13

- TCI 상위: 자극추구(60점), 위험회피(18점), 연대감(17점)
- 애니어그램: 9번 (평화주의자)
- MBTI: ESFP
- MBTI 특성: 사람들과의 교류에서 에너지를 얻는, 현실적이고 구체적인 것을 선호하는, 사람과 가치를 중심으로 결정하는, 유연하고 즉흥적인 것을 즐기는
- 매칭된 남편상: free_dreamer_e
- 매칭 점수: 72%
```

---

## 2. 카드 1 — 커버 (고정 텍스트, LLM 미사용)

> 타이틀: "당신이 몰래 본 영상이, 당신을 말하고 있다"
> subtitle: "INTRO"

```
새벽 두 시, 아무도 모르게 재생한 그 영상. 습관처럼 누른 구독 버튼, 알고리즘이 슬쩍 건넨 추천 한 줄.

거기엔 당신도 의식하지 못한 욕구와 결핍, 끌림의 방향이 고스란히 기록되어 있습니다.

유튜브는 생각보다 사적인 공간입니다. 타인 앞에서는 쉽게 포장하지만, 혼자 보는 화면 앞에서만큼은 누구나 꽤 정직해지니까요.

지금부터 당신의 구독 채널과 시청 패턴을 찬찬히 들여다보겠습니다. 그 안에서 당신의 성격 구조와 관계 욕구를 읽어내고, 평생의 동반자가 될 사람의 유형과 구체적인 프로필, 그리고 절대 참을 수 없는 상대의 단점까지 짚어드리겠습니다.

준비되셨다면, 시작합니다.
```

---

## 3. 배치 1 프롬프트 → 카드 2, 3, 4

> 파일: `run-from-channels.ts` → `generateBatch1()`

### 프롬프트

```
당신은 심리 분석 전문가입니다. 아래 분석 데이터를 바탕으로 3개의 리포트 카드 내용을 JSON 형식으로 생성해주세요.

## ⚠️ 중요: 모든 카드는 1,500자 이상 2,000자 이하로 작성하세요!

{공유 분석 데이터 컨텍스트 — 위의 "1. 공유 분석 데이터 컨텍스트" 참조}

## 생성할 카드

### 카드 2: 구독 데이터 개요 (1500-2000자)
- "2_title": 마케팅 카피 타이틀 (예: "당신은 다양한 경험을 통해 세상을 탐험하는 취향을 지니셨군요")
- "2": 본문 - 육각형 차트 해석, 상위 카테고리 의미, 볼드 섹션 헤더 사용

### 카드 3: 구독 카테고리 랭킹 (1500-2000자)
- "3_title": "당신의 구독 취향은 상위 ${rarity.percentile}%에요"
- "3": 본문
  1) **"당신의 세상은 온통 ${ytCats[0]?.name || '다양함'}로 가득해요"**
  2) 총 ${data.channelCount}개 채널 구독 중이라는 것
  3) 카테고리 랭킹 설명 (1위~5위 각각 의미 해석)
  4) 이 조합이 왜 희소한지 설명
  5) Spotify Wrapped 스타일의 임팩트 있는 문체

### 카드 4: 희귀 취향 분석 (1500-2000자)
- "4": 본문
  1) 가장 희귀한 카테고리: ${rarity.rarestCategoryName}
  2) "이 카테고리를 구독하는 사용자는 전체의 ${rarity.rarestCategoryPercent}%에 불과해요"
  3) 해당 채널 리스트: ${rarity.rarestCategoryChannels.join(', ')}
  4) 이 취향이 심리적으로 의미하는 바 (2-3문단)
  5) 시그니처 카피: "${data.channelCount}개 채널 중 단 ${rarity.rarestCategoryChannels.length}개. 그게 당신의 시그니처예요."

## 응답 형식 (JSON)
{
  "2_title": "타이틀",
  "2": "본문",
  "3_title": "당신의 구독 취향은 상위 ${rarity.percentile}%에요",
  "3": "본문",
  "4": "본문"
}
```

### 생성된 결과

**카드 2** — 구독 데이터 개요
- 타이틀: `당신은 다양한 경험을 통해 세상을 탐험하는 취향을 지니셨군요`
- subtitle: `구독 데이터 개요`

```
당신의 구독 데이터를 살펴보면, 다양한 카테고리에서의 폭넓은 관심사를 엿볼 수 있습니다. 특히, 당신은 총 23개의 채널을 구독하고 있으며, 이는 당신이 새로운 경험과 지식을 추구하는 성향을 잘 보여줍니다. 육각형 차트에서 자율성이 100점으로 가장 높은 수치를 기록하고 있어, 당신은 독립적인 사고방식과 행동을 선호하는 경향이 있습니다. 자극추구 또한 100점으로 높은 점수를 받아, 새로운 자극과 경험을 찾는 데 큰 열정을 보이고 있습니다. 위험회피 점수가 낮은 것은 당신이 모험을 두려워하지 않는 강한 성격을 나타내며, 이는 관계에서도 상대방과의 새로운 경험을 적극적으로 탐색하는 데 도움이 될 것입니다. 또한, 연대감 지수가 100점으로 매우 높아, 사람들과의 유대감을 소중히 여기는 당신의 가치관이 드러납니다. 이러한 조합은 당신이 다양한 사람들과의 소통을 통해 풍부한 삶의 경험을 쌓고자 하는 열망을 나타내며, 이는 결혼이나 연애에서도 긍정적인 영향을 미칠 것입니다.
```

**카드 3** — 구독 카테고리 랭킹
- 타이틀: `당신의 구독 취향은 상위 10%에요`
- subtitle: `Your Subscription DNA`

```
당신의 세상은 온통 기타로 가득해요. 23개의 채널 구독 중에서 가장 많이 선택한 카테고리는 '기타'로, 이는 당신이 여러 가지 다양한 콘텐츠를 통해 다양한 시각을 얻고 싶어하는 욕구를 반영합니다. **1위: 기타** - 당신은 일상에서 느끼는 여러 감정과 경험을 다양한 방식으로 표현하고 싶어합니다. **2위: 브이로그/일상** - 일상 속 소소한 이야기와 사람들의 삶을 통해 공감하고 싶어 하는 당신의 성향을 나타냅니다. **3위: 예능/버라이어티** - 즐거움과 웃음을 추구하는 경향이 강한 당신은 유머를 통해 사람들과의 관계를 더욱 깊이 있게 다지고자 합니다. **4위: 교육/자기계발** - 지속적인 성장과 발전을 위해 배우고자 하는 당신의 의지를 보여줍니다. **5위: 음악** - 감정의 표현을 음악을 통해 찾는 당신은 예술적 감성이 풍부하다고 할 수 있습니다. 이 조합은 단순한 취향을 넘어, 당신이 더 많은 사람들과 소통하고 다양한 경험을 쌓기 위해 끊임없이 노력하는 모습을 보여줍니다. 이런 독특한 조합은 전체 구독자 중 상위 10%에 해당하는 드문 취향입니다.
```

**카드 4** — 희귀 취향 분석
- 타이틀: `당신에게서 발견한 특별한 취향` (고정)
- subtitle: `Hidden Gem in Your List`

```
가장 희귀한 카테고리는 ASMR입니다. 이 카테고리를 구독하는 사용자는 전체의 4%에 불과하다는 사실은 당신의 특별한 감성을 나타냅니다. ASMR은 감각적인 경험을 통해 편안함과 안정감을 얻고자 하는 욕구를 반영하는데, 이는 당신이 일상에서 스트레스를 해소하고 싶어하는 마음의 표출로 볼 수 있습니다. 해당 채널인 '낮잠 NZ Ambience'는 자연의 소리나 편안한 분위기를 통해 힐링을 주는 콘텐츠로, 당신의 내면에서 느끼는 안정감과 조화로운 삶을 추구하는 욕망을 잘 나타냅니다. 이런 독특한 취향은 당신이 감각적으로 세상을 경험하고, 내면의 평화를 찾고자 하는 깊은 욕구를 지니고 있다는 것을 의미합니다. 23개 채널 중 단 1개. 그게 당신의 시그니처예요.
```

---

## 4. 배치 2 프롬프트 → 카드 5, 6, 7, 8

> 파일: `run-from-channels.ts` → `generateBatch2()`

### 프롬프트

```
당신은 심리 분석 전문가입니다. 아래 분석 데이터를 바탕으로 4개의 리포트 카드 내용을 JSON 형식으로 생성해주세요.

## ⚠️ 중요: 모든 카드는 1,500자 이상 2,000자 이하로 작성하세요!

{공유 분석 데이터 컨텍스트 — 위의 "1. 공유 분석 데이터 컨텍스트" 참조}

## 생성할 카드

### 카드 5: 통합 유형 분석 (1500-2000자)
- "5_subtitle": 영어 타입명 (예: "Adventurous Social Explorer Type")
- "5_title": "당신은 {타입이름} 타입이에요"
  · ${topBottom.top1.name}(1위) + ${topBottom.top2.name}(2위) + ${topBottom.bottom.name}(최저) 조합 기반
  · 예: 자극추구(1위) + 연대감(2위) + 위험회피(최저) → "거침없는 사교형 탐험가"
- "5": 본문 - 볼드 섹션 헤더 사용, MBTI/애니어그램 명칭 없이 특징만 서술

### 카드 6: 당신의 감성 (1500-2000자)
- "6": 감정 처리 방식, 힐링 패턴, 근거

### 카드 7: 추구하는 미래 (1500-2000자)
- "7": 미래상 비유, 3축 분석, 구체적 장면

### 카드 8: 견디기 힘든 상대방의 단점 (1500-2000자)
- "8": 힘든 특성, 왜 힘든지, 상황 예시, 리프레이밍

## 응답 형식 (JSON)
{
  "5_subtitle": "영어 타입명",
  "5_title": "당신은 {타입} 타입이에요",
  "5": "본문",
  "6": "본문",
  "7": "본문",
  "8": "본문"
}
```

### 생성된 결과

**카드 5** — 통합 유형 분석
- 타이틀: `당신은 모험적인 자유로운 영혼 타입이에요`
- subtitle: `Adventurous Free Spirit Type`

```
자율성(1위)과 자극추구(2위), 그리고 위험회피(최저)의 조합은 당신이 매우 자유롭고 모험을 즐기는 성격임을 드러냅니다. 당신은 언제 어디서나 새로운 경험을 찾고, 이를 통해 자신을 표현하는 것을 좋아합니다. 한편, 위험회피가 낮다는 것은 당신이 새로운 도전을 두려워하지 않고, 오히려 이를 통해 성장하고 발전할 수 있는 기회를 찾는 것을 의미합니다. 사람들과의 관계에서도 당신은 유연하고 즉흥적인 접근을 취하며, 새로운 사람들과의 연결을 즐깁니다. 당신의 감정은 깊고 풍부하며, 이는 관계에서도 상대방과의 깊은 유대감을 만들어가는 데 큰 도움이 될 것입니다. 이런 특성을 바탕으로 당신은 누구와도 쉽게 연결될 수 있는 매력을 지니고 있습니다.
```

**카드 6** — 당신의 감성
- 타이틀: `당신의 감성` (고정)
- subtitle: `감정 스타일`

```
당신의 감성은 매우 풍부하고 다채롭습니다. 감정을 처리하는 방식에서, 당신은 상황에 따라 즉각적으로 반응하고, 감정의 흐름을 자연스럽게 받아들이는 경향이 강합니다. 이는 당신이 사람들과의 관계에서 감정을 솔직하게 드러내고, 상대방의 감정에도 민감하게 반응할 수 있는 능력을 지니고 있다는 것을 의미합니다. 힐링 패턴 또한 매우 독특한데, 자연의 소리나 차분한 음악을 통해 심리적인 안정을 찾고자 하는 모습이 보입니다. 이러한 감정 처리 방식은 당신이 관계에서 신뢰를 쌓고, 상대방과의 유대감을 더욱 깊이 있게 만들어가는 데 기여할 것입니다.
```

**카드 7** — 추구하는 미래
- 타이틀: `추구하는 미래` (고정)
- subtitle: `미래상`

```
당신이 그리는 미래는 마치 한 폭의 그림 같습니다. 푸른 하늘 아래, 다양한 사람들과 함께하는 즐거운 여행을 떠나는 모습이 나타납니다. 새로운 장소에서 사람들과의 연결을 통해 각기 다른 문화와 경험을 나누며, 삶의 의미를 깊이 있게 탐색하는 모습입니다. 자율성과 자극추구의 특성 덕분에, 당신은 항상 새로운 목표와 도전을 찾아 나서고, 이를 통해 자신을 발전시키는 기회를 놓치지 않는 모습을 그릴 수 있습니다. 이러한 미래는 단순한 목표 달성을 넘어서, 진정한 행복과 만족감을 찾는 여정임을 말해줍니다.
```

**카드 8** — 견디기 힘든 상대방의 단점
- 타이틀: `견디기 힘든 상대방의 단점` (고정)
- subtitle: `관계 인사이트`

```
상대방의 단점 중 가장 힘든 것은 지나치게 소극적인 태도입니다. 이는 당신이 모험과 새로운 경험을 추구하는 만큼, 상대방이 이를 함께하지 않거나 소극적으로 반응할 때 큰 실망을 느낄 수 있습니다. 예를 들어, 당신이 새로운 활동을 제안했을 때, 상대방이 주저하거나 회피한다면, 이는 당신에게 큰 스트레스로 작용할 수 있습니다. 하지만 이 상황을 리프레이밍 해보면, 상대방이 소극적인 이유가 여러 가지가 있을 수 있음을 이해하게 됩니다. 이를 통해 상대방의 입장을 존중하고, 보다 긍정적인 대화를 나누는 것이 중요하다는 것을 깨닫게 될 것입니다.
```

---

## 5. 배치 3 프롬프트 → 카드 9, 10, 11

> 파일: `run-from-channels.ts` → `generateBatch3()`

### 프롬프트

```
당신은 심리 분석 전문가입니다. 아래 분석 데이터를 바탕으로 3개의 리포트 카드 내용을 JSON 형식으로 생성해주세요.

## ⚠️ 중요: 모든 카드는 1,500자 이상 2,000자 이하로 작성하세요!

{공유 분석 데이터 컨텍스트 — 위의 "1. 공유 분석 데이터 컨텍스트" 참조}

## 생성할 카드

### 카드 9: 당신의 왕자님은 (1500-2000자)
- "9": 대형 비유 문구, 유형 정의, 첫 만남 장면, 왜 이 유형인지

### 카드 10: 왕자님 상세 프로필 (1500-2000자)
- "10": 기본 정보, 이런 분이에요, 함께하면 이런 모습 (3개 장면), 알아두세요

### 카드 11: 결제 유도 (1500-2000자)
- "11": 마무리, Phase 2 미리보기 (블러 처리된 힌트), CTA ₩4,900

## 응답 형식 (JSON)
{
  "9": "본문",
  "10": "본문",
  "11": "본문"
}
```

### 생성된 결과

**카드 9** — 당신의 왕자님은
- 타이틀: `당신의 왕자님은` (고정)
- subtitle: `매칭 결과`

```
당신의 왕자님은 마치 구름 위를 걷는 듯한 자유로운 영혼입니다. 이 유형은 언제나 새로운 것을 탐험하고, 상상력을 발휘하며, 당신과 함께 즐거운 순간들을 만들어 갈 수 있는 사람입니다. 첫 만남의 순간, 그는 당신의 눈을 바라보며 즉흥적인 대화를 나누고, 서로의 꿈과 희망에 대해 이야기합니다. 그가 왜 이 유형인지, 당신과의 깊은 유대감을 통해 서로의 삶을 풍부하게 만들어 가는 데 기여할 수 있을 것입니다.
```

**카드 10** — 왕자님 상세 프로필
- 타이틀: `왕자님 상세 프로필` (고정)
- subtitle: `파트너 프로필`

```
왕자님의 기본 정보는 그가 외향적이고 자유로운 삶을 추구하는 성격을 지니고 있다는 것입니다. 그는 항상 새로운 경험을 찾고, 사람들과의 소통을 즐기는 분입니다. 함께하면 당신은 그와의 관계에서 많은 즐거움과 행복을 느낄 수 있을 것입니다. 또한, 그는 당신의 감정을 존중하고, 항상 당신이 편안하게 느낄 수 있도록 배려하는 성향을 지니고 있습니다. 알아두세요, 그의 열정과 활력이 당신의 삶을 더욱 풍요롭게 만들어 줄 것입니다.
```

**카드 11** — 결제 유도
- 타이틀: `더 깊은 분석이 궁금하신가요?` (고정)
- subtitle: `Phase 2 안내`

```
마무리하며, 당신의 독특한 취향과 성격을 통해 새로운 관계의 가능성을 탐색할 수 있는 기회를 가지셨습니다. Phase 2에서는 더 깊은 분석과 인사이트를 통해, 당신의 관계가 어떻게 발전할 수 있는지를 함께 탐구해보는 시간을 마련할 예정입니다. 당신의 여정은 이제 시작입니다. 함께 이 여정을 계속해 나가길 바랍니다.
```

---

## 6. 이전 문제점 및 해결 현황 (2026-02-10 리팩토링)

| 문제 | 해결 방법 | 상태 |
|------|----------|------|
| 글자 수 부족 (400-800자) | max_tokens 4096→8192, 배치 3→4개 분할, few-shot 예시 추가 | ✅ 해결 |
| 카드 9,10 구체성 부족 | buildAnalysisContext에 남편 타입 상세 정보(description, metaphor, variant) 추가 | ✅ 해결 |
| "기타" 카테고리 1위 | 2-pass 재분류 전략 + 카테고리별 예시 채널 추가 | ✅ 해결 |
| 시스템 프롬프트 모순 | "마크다운 금지" → "기본 마크다운 허용"으로 변경 | ✅ 해결 |
| 카드 11 CTA 누락 | 카드 11을 고정 텍스트로 변경 (LLM 미사용) | ✅ 해결 |
| TCI 이중 전달 혼란 | YouTube TCI(정규화)만 LLM에 전달, 원본 TCI는 매칭용 내부 유지 | ✅ 해결 |

### 리팩토링 후 배치 구조

| 배치 | 카드 | max_tokens | 비고 |
|------|------|------------|------|
| - | 카드 1 | - | 고정 텍스트 (인트로) |
| Batch A | 카드 2, 3 | 8192 | 구독 데이터 + 랭킹 |
| Batch B | 카드 4, 5 | 8192 | 희귀 취향 + 유형 분석 |
| Batch C | 카드 6, 7, 8 | 8192 | 감성 + 미래 + 단점 |
| Batch D | 카드 9, 10 | 8192 | 왕자님 + 프로필 |
| - | 카드 11 | - | 고정 텍스트 (CTA) |

---

## 7. 관련 파일 경로

| 파일 | 역할 |
|------|------|
| `src/lib/husband-match/prompts/system-prompt.ts` | 시스템 프롬프트 |
| `src/app/api/analyze/phase1/run-from-channels.ts` | 카드 생성 메인 로직 (배치 A/B/C/D + fallback) |
| `src/lib/husband-match/prompts/card-prompts.ts` | 카드 데이터 헬퍼 (ENNEAGRAM_NAMES, TCI_NAMES 등) |
| `src/lib/husband-match/data/husband-types.ts` | 48개 남편 타입 데이터 |
| `src/lib/husband-match/analysis/youtube-analysis.ts` | YouTube 16개 카테고리 분류 (2-pass) + TCI 계산 |
| `src/lib/gemini-client.ts` | Gemini API 래퍼 (chatCompletion, visionCompletion) |
